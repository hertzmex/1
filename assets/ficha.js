"use strict";var error=0,map=null,estados=null,markers=[],markerCluster;Array.prototype.where||(Array.prototype.where=function(e,a){var n;return null===a&&(a=function(e,a){return e===a}),"object"!=typeof e?[]:(n=Object.keys(e).length,this.filter(function(r){var t,o,i;o=0;for(t in e)i=e[t],a(r[t],i)&&(o+=1);return o===n}))}),$(function(){function e(e,a){return void 0!==e&&""!==e.trim()?"<br>"+a+": "+e:""}function a(e){var a=0;try{if($("#municipio").html('<option value="-1">Selecciona tu Municipio</option>'),"-1"===e)return void $("#oficinas").html("");var n=s[e].municipalities;for(a=0;a<n.length;a++)$("#municipio").append("<option value="+a+" >"+n[a].municipality+"</option>")}catch(e){}}function n(a){try{var n=s[$("#estado").val()].municipalities[a].offices;if(n.length>0){$("#oficinas").html("<dt> Oficinas ");for(var r=0;r<n.length;r++){var t=n[r],o=$("<dd/>"),u=$("<p/>").append("<strong> Nombre de la oficina </strong><br>").append(i[t].name+"<br>").append(i[t].type_of_road+" "+i[t].name_road+"<br>").append("N\xfamero exterior: "+i[t].number_ext).append(e(i[t].number_int,"N\xfamero interior")).append("<br>Nombre Localidad: "+i[t].name_locality).append("<br>C.P: "+i[t].zip_code).append("<br>Estado: "+i[t].state).append("<br>Municipio: "+i[t].municipality_name+"<br>");$("<a/>").attr("href","#googleMap").attr("data-lat",i[t].latitude).attr("data-lon",i[t].longitude).attr("title",i[t].name).click(function(a){a.preventDefault(),null===c&&($("#googleMap").show(),l={center:new google.maps.LatLng(21.352211,-99.186974),zoom:4,mapTypeId:google.maps.MapTypeId.ROADMAP},null!==document.getElementById("googleMap")&&null===c&&(c=new google.maps.Map(document.getElementById("googleMap"),l))),$("#googleMap").show();var n=new String('<div id="content"><div id="siteNotice"><p><strong> Nombre de la oficina: </strong><br>'+i[t].name+"<br><strong> Direcci\xf3n: </strong><br>"+i[t].type_of_road+" "+i[t].name_road+"<br>N\xfamero exterior: "+i[t].number_ext+e(i[t].number_int,"N\xfamero interior")+e(i[t].name_locality,"Nombre Localidad")+e(i[t].zip_code,"C.P")+e(i[t].state,"Estado")+e(i[t].municipality_name,"Municipio"));null!==i[t].lada&&(n+="<br>lada: "+i[t].lada),null!==i[t].contact_phone&&(n+="<br>telefono: "+i[t].contact_phone),n+="</p></div></div>";var r=new google.maps.Marker({position:new google.maps.LatLng($(this).attr("data-lat"),$(this).attr("data-lon")),title:$(this).attr("title"),animation:google.maps.Animation.DROP});if(google.maps.event.addListener(r,"click",function(){new google.maps.InfoWindow({content:this.contentString}).open(c,this)}),markers=[],markers.push(r),void 0!==c&&void 0!==markers){new MarkerClusterer(c,markers);c.setCenter(new google.maps.LatLng($(this).attr("data-lat"),$(this).attr("data-lon"))),c.setZoom(18)}}).text("Ver el mapa").appendTo(u);u.appendTo(o),o.appendTo("#oficinas"),null!==i[t].lada&&$("#oficinas").append(i[t].lada),null!==i[t].contact_phone&&$("#oficinas").append(i[t].contact_phone);for(var d=0;d<i[t].schedule.length;d++)""!==i[t].schedule[d].days.trim()&&void 0!==i[t].schedule[d].days&&$("#oficinas").append("<p>"+i[t].schedule[d].type_schedule+": "+i[t].schedule[d].days.toLowerCase()+" "+i[t].schedule[d].day_work+"<br/> </p>")}}}catch(e){}}var r,t,o,i=JSON.parse($("#officesCNTSE").val()),s=JSON.parse($("#estadosCNTSE").val()),c=null,l=null;return $("#estado").change(function(){$("#googleMap").hide(),a($(this).val())}),$("#municipio").change(function(){$("#googleMap").hide(),n($(this).val())}),r=function(){var e,a,n;return e=gon.municipalities.where({state:$("#entity_office").val()}),n=function(){var n,r,t,o;for(t=e[0].municipalities,o=[],n=0,r=t.length;n<r;n++)a=t[n],o.push("<option>"+a.municipality+"</option>");return o}(),$("#municipality_office").html(n),$("#municipality_office").prepend("<option selected>Seleccionar Municipio...</option>"),$("#office_description").html("")},t=function(){var e,a,n;return e=gon.municipalities.where({state:$("#entity_office").val()}),a=e[0].municipalities.where({municipality:$("#municipality_office").val()}),n=o(a[0].offices),$("#office_description").html(n)},o=function(e){var a,n,r,t,o,i,s;i=[];for(var c=0,n=e.length;c<n;c++){if(a=e[c],t="<div class='blockquote'style='margin-top:20px;margin-bottom:20px;'><strong>Nombre de la oficina:</strong><br/><strong>"+a.name+"</strong>"+("<p style='margin-bottom:0px;'>"+a.type_of_road+" "+a.name_road+" #"+a.number_ext+"<br/>C.P. "+a.zip_code+", "+a.name_locality+"<br/>"),a.schedule){o=a.schedule;for(var l=0,r=o.length;l<r;l++)s=o[l],t+=s.type_schedule+": "+s.days+" "+s.day_work+"<br/>"}i.push(t+="</p></div>")}return i},$("#municipality_office").on("change",t),$("#entity_office").on("change",r),$(".suggestionsBtn").on("click",function(e){return e.preventDefault(),$("#sugerencia").removeClass("hidden"),$('input[name="q1"]').prop("checked",!1),$('input[name="q2"]').prop("checked",!1),$("#q22c").addClass("hidden"),$("#q22").val(""),$("#q3").val(""),$("#sugerencia").focus(),!1}),$(".wrongInfoBtn").on("click",function(e){return e.preventDefault(),$("#error").removeClass("hidden"),$("#q4").val(""),$("#error").focus(),!1}),$('input[name="q2"]').on("click",function(){var e;return e=$('input[name="q2"]:checked').val(),"1"===e?$("#q22c").removeClass("hidden"):($("#q22c").addClass("hidden"),$("#q22").val(""))}),$(".suggestionsSurveyBtnCancel").on("click",function(e){return e.preventDefault(),$("#sugerencia").addClass("hidden"),$('input[name="q1"]').prop("checked",!1),$('input[name="q2"]').prop("checked",!1),$("#q22c").addClass("hidden"),$("#q22").val(""),$("#q3").val("")}),$(".suggestionsSurveyBtn").on("click",function(e){e.preventDefault();var a,n,r,t,o,i,s=!1,c="";return r=$('input[name="q1"]:checked').val(),t=$('input[name="q2"]:checked').val(),o=$("#q22").val().trim(),i=$("#q3").val().trim(),a=$("#authenticity_token_sugerencia").val().trim(),n=$("#homoclave").val().trim(),void 0===r?($(".form-sugerencias-q1").removeClass("sr-only"),c="question1",s=!0):$(".form-sugerencias-q1").addClass("sr-only"),void 0===t?($(".form-sugerencias-q2").removeClass("sr-only"),""==c&&(c="question2"),s=!0):$(".form-sugerencias-q2").addClass("sr-only"),"1"===t&&0===o.length?($(".form-sugerencias-q22").removeClass("sr-only"),$(".form-sugerencias-text-q22").css("border-color","#D0021B"),""==c&&(c="question22"),s=!0):($(".form-sugerencias-q22").addClass("sr-only"),$(".form-sugerencias-text-q22").css("border-color","#cccccc")),0===i.length?($(".form-sugerencias-q3").removeClass("sr-only"),$(".form-sugerencias-text-q3").css("border-color","#D0021B"),""==c&&(c="question3"),s=!0):($(".form-sugerencias-q3").addClass("sr-only"),$(".form-sugerencias-text-q3").css("border-color","#cccccc")),s?($("#notification_wrapper").addClass("alert alert-danger").html("Todas las preguntas son obligatorias, Haz click para cerrar").click(function(){$(this).removeClass("alert alert-danger").html("")}),$("#"+c).focus(),!1):($.ajax("/tramites/encuesta/tecnica/"+n,{type:"POST",dataType:"json",data:{q1:r,q2:t,q22:o,q3:i,cntse_homoclave:$("#cnts-homoclave").val(),authenticity_token:a},error:function(){return console.log("Servicio no disponible"),0},success:function(){$("#sugerencia").addClass("hidden"),$('input[name="q1"]').prop("checked",!1),$('input[name="q2"]').prop("checked",!1),$("#q22c").addClass("hidden"),$("#q22").val(""),$("#q3").val("");var e=$(".suggestionsBtn").offset().top;$(window).scrollTop(e),$("#respuesta").addClass("alert alert-success").html("Hemos recibido tus sugerencias, gracias por ayudarnos a mejorar. Haz click para cerrar"),$("#respuesta").attr("aria-live","polite"),$("#respuesta").click(function(){$(this).removeClass("alert alert-success").html("")}),$(".wrongInfoBtn").focus()}}),!1)}),$(".errorSurveyBtnCancelar").on("click",function(e){return e.preventDefault(),$("#error").addClass("hidden")}),$(".errorSurveyBtn").on("click",function(e){e.preventDefault();var a,n,r;return $("#q4").val().trim().length>0?(r=$("#q4").val().trim(),a=$("#authenticity_token_incorrecto").val().trim(),n=$("#homoclave").val().trim(),$("#issue_notification_wrapper").removeClass("alert alert-danger").html(""),$.ajax("/tramites/encuesta/tecnica/"+n,{type:"POST",dataType:"json",data:{q4:r,authenticity_token:a,cntse_homoclave:$("#cnts-homoclave").val()},error:function(){return console.log("servicio no disponible"),0},success:function(){$("#error").addClass("hidden"),$("#q4").val(""),$(".form-sugerencias-q4").addClass("sr-only"),$("#respuestaIncorrecto").addClass("alert alert-success").html("Hemos recibido tus sugerencias, gracias por ayudarnos a mejorar. Haz click para cerrar"),$("#respuestaIncorrecto").attr("aria-live","polite"),$("#respuestaIncorrecto").click(function(){$(this).removeClass("alert alert-success").html("")}),$(".wrongInfoBtn").focus()}}),!1):($("#issue_notification_wrapper").addClass("alert alert-danger").html("La descripci\xf3n del error en la ficha es requerida, Haz click aqu\xed para cerrar").click(function(){$(this).html(""),$(this).removeClass("alert alert-danger")}),$(".form-sugerencias-q4").removeClass("sr-only"),$(".form-sugerencias-text-q4").css("border-color","#D0021B"),!1)}),$(".inner-page.ficha").on("click",function(){return $(".dropDownItem").removeClass("open")})});